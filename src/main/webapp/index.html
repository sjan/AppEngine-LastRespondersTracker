<html>
<head>
	<link rel="stylesheet" type="text/css" href="css/tracker.css">
	<link rel="stylesheet" href="font-awesome-4.6.3/css/font-awesome.min.css">

  <script type="text/javascript"> 
  	var routeCoordinates = [];
  	var progressCoordinates = [];
  	var map;
  	var oneDay = 24*60*60*1000; // hours*minutes*seconds*milliseconds
  	var JOURNEY_START_DATE = new Date(2016,7,24);
	var TODAY = new Date();
	var diffDay = Math.round((TODAY.getTime() - JOURNEY_START_DATE.getTime())/(oneDay));
	var MAP_PIN = 'M0-48c-9.8 0-17.7 7.8-17.7 17.4 0 15.5 17.7 30.6 17.7 30.6s17.7-15.4 17.7-30.6c0-9.6-7.9-17.4-17.7-17.4z';
	var daycount = 0;
	var PROGRESS_COLOR = "#2196F3";
	var PLAN_COLOR = "#616161";
	var planPosition ; 
	var nowPosition ;
	
	if(diffDay < 0) {
		daycount = 0;
	} else {
		daycount = diffDay;
	}

  </script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
  <script type="text/javascript">
    $(document).ready(function() {
      $.ajax({
          type: "GET",
          dataType: "json",
          crossDomain:"true",
          url: "/rest/journey/plannedRoute",
          success: function(array){
            for(i = 0;i< array.length ; i++) {
              if(i === daycount) {
                 planPosition = {lat : parseFloat(array[i].latitude), lng : parseFloat(array[i].longitude) };
              }
              routeCoordinates.push({lat : parseFloat(array[i].latitude), lng : parseFloat(array[i].longitude) });
            }

            var flightPath = new google.maps.Polyline({
              path: routeCoordinates,
              geodesic: true,
              strokeColor: PLAN_COLOR,
              strokeOpacity: 0.70,
              strokeWeight: 4
            });
            flightPath.setMap(map);

            var marker = new google.maps.Marker({
	            position: planPosition,
	            map: map,
	            icon: {
					path: MAP_PIN,
					fillColor: PLAN_COLOR,
					fillOpacity: .7,
					strokeWeight: 2,
					strokeColor: '#FFFFFF',
				}
            });
            

          },
          error: function(data) {
            console.log("fail function " + JSON.stringify(data));
         }
     });
     
     $.ajax({
          type: "GET",
          dataType: "json",
          crossDomain:"true",
          url: "/rest/journey/progressRoute",
          success: function(array){
            for(i = 0;i< array.length ; i++) {
              progressCoordinates.push({lat : parseFloat(array[i].latitude), lng : parseFloat(array[i].longitude) });
            }
            
			var progressPath = new google.maps.Polyline({
              path: progressCoordinates ,
              geodesic: true,
              strokeColor: PROGRESS_COLOR,
              strokeOpacity: 1,
              strokeWeight: 4
            });
            progressPath.setMap(map);
          },
          error: function(data) {
            console.log("fail function " + JSON.stringify(data));
         }
     });
     
      $.ajax({
          type: "GET",
          dataType: "json",
          crossDomain:"true",
          url: "/rest/journey/progressPosition",
          success: function(data){
            nowPosition ={lat : parseFloat(data.latitude), lng : parseFloat(data.longitude) }; 
          	var marker = new google.maps.Marker({
	            position: nowPosition,
	            map: map,
	            icon: {
					path: MAP_PIN,
					fillColor: PROGRESS_COLOR,
					fillOpacity: .9,
					strokeWeight: 2,
					strokeColor: '#FFFFFF',
				}
            });
            
            map.panTo(nowPosition);            

          },
          error: function(data) {
            console.log("fail function " + JSON.stringify(data));
         }
     });
     
     $.ajax({
          type: "GET",
          dataType: "json",
          crossDomain:"true",
          url: "/rest/journey/plannedStatus",
          success: function(data){
          	$('#infoPlannedTitle').text("Plan " + data["distance"].toFixed(2) + " miles");
          },
          error: function(data) {
            console.log("fail function " + JSON.stringify(data));
         }
     });
     
      $.ajax({
          type: "GET",
          dataType: "json",
          crossDomain:"true",
          url: "/rest/journey/progressStatus",
          success: function(data){
            $('#infoProgressTitle').html("Progress " + data["distance"].toFixed(2) + " miles");
          },
          error: function(data) {
            console.log("fail function " + JSON.stringify(data));
         }
     });
   }
 )
 </script>
</head>

  <body>
  <div id="wrapper">
  	<div id="infoContainer">
  		<div id="infoLabel">
  		  	<span id="infoLabelTitle">Project Spark: </span>
  			<span id="infoLabelSubTitle">Day X</span>
  		</div>
  		<div id="infoProgress" ><span id="infoProgressIcon"><i class="fa fa-circle"></i></span><span id="infoProgressTitle">Progress 0.00 miles</span></div>
  		<div id="infoPlanned"><span id="infoPlannedIcon"><i class="fa fa-circle"></i></span><span id="infoPlannedTitle">Plan 0.00 miles</span></div>  			
  	</div>
  	<div id="googleMap" style="width: 100vw; height: 100vh;"></div>
    </div>
    <script>
      function initMap() {
        var mapProp = {
          center:new google.maps.LatLng(51.508742,-0.120850),
          zoom:4,
          mapTypeId:google.maps.MapTypeId.ROADMAP,
          mapTypeControl: false,
          streetViewControl: false
        };
        map=new google.maps.Map(document.getElementById("googleMap"), mapProp);
      }
      
      if(diffDay < 0) {
		$('#infoLabelSubTitle').text(-diffDay  + " Days until launch");
	  } else {
		$('#infoLabelSubTitle').text("Day " + daycount);				
	  }
	
	$("#infoProgressIcon").click(function(){
        map.panTo(nowPosition);
    });
    
    $("#infoPlannedIcon").click(function(){
        map.panTo(planPosition);
    });
    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCciPUBCbLiRVE6Vf_TbVJrtVUSLvtSvuU&callback=initMap"></script>
    
  </body>
</html>
